<html>
<head>
	<title>N/A</title>
	<meta charset="iso-8859-1"/>
	<meta name="author" content="Bernardo Meyer">
	<meta name="description" content="Criando os estilos para o interior do IFRAME">
	<meta name="keywords" content="sites, web, desenvolvimento, jscript, javascript">
	<style>
		BODY.frame {
			font-family: Verdana; 
			font-size: 28px;
			}	
		BODY {
			font-family: Verdana; 
			font-size: 18px;
			}
		B.frame {color:#1C1C1C;}
		BUTTON {
			background: darkgreen;
			border: solid 1px green;
			border-radius: 6px;
			color:white;
			height: 33px; 
			vertical-align: top;
			width: 35px;
			}
		BUTTON.action {border: solid 2px turquoise;width: 60px;}
		BUTTON.big {font-size: 18px;height: 32px;}
		DIV#geral {display: table-row;background: #363636;}
		DIV#geral DIV {display: table-cell; position:relative;float: left;}
		DIV#painel {background: lightgrey;margin: 6px;}
		DIV#tela {padding-top: 30px;}
		DIV#tools {
			background-color: lightcyan;
			border: solid 1px powderblue;
			border-radius: 6px;
			color: teal;
			display: none;
			left: 350px;
			position: absolute;
			top: -500px;
			width: 400px;			
			}
		DIV#tools  TABLE {
			margin: 0px;
			padding: 0px;
			width: 100%;
			}
		DIV#tools  TABLE  CAPTION{
			color: darkcyan;
			font-size: 24px;
			font-weight: bold;
			}				
		H1 {color: DarkOliveGreen; text-shadow: 1px 1px gray;}
		IFRAME {
			background: lightgrey;
			float: left;
			margin-top: 2px;
			}
		INPUT {width: 40px; color: DarkOliveGreen;}
		LABEL { color: darkgreen; }
		TEXTAREA {
			font-family: Verdana; 
			font-size: 28px;
			}
	</style>
	<link rel="shortcut icon" href="favicon.ico" />
	<script>
		var ESTILOS = "";
		function fillTitle(){
			// Descrição da página - document.head
			var descri = document.head.querySelector("meta[name=description]");
			getTag("titulo").innerText = descri.content;
			// Nome da script - window.location - split
			var path = window. location. pathname;
			var arrPath = path. split("/");
			var page = arrPath. pop();
			document.title = page;			
			}
		function getTag(nomeId){
			return document.getElementById(nomeId);
			}
		function mostra(nomeId){
			getTag(nomeId).style.display = "block";
			}
		function esconde(nomeId){
			event.stopPropagation();
			getTag(nomeId).style.display = "none";
			}
		function clicDiv(valor){
			event.stopPropagation();
			var retang = valor;
			var aviso = getTag("aviso");
			aviso.innerText = "Retângulo "+retang;
			mostra("quadro");
			return; 
			}
		function clickBody(evt){
			alert('Você clicou na página do navegador.');
			}
		function getSele(){
			var el = getTag("area1");
			var el_ini = el.selectionStart;
			var el_fim = el.selectionEnd;
			console.log("selecionou de "+el_ini+" até "+el_fim);
			el.setSelectionRange(el_ini, el_fim);
			console.log((el.value).substr(el_ini,el_fim-el_ini));
			getTag("ini").value = el_ini;
			getTag("fim").value = el_fim;
			return;
			};			
		function cerca(pTag){

			var texto = getTag("area1").value;
			var tam = texto.length;
			var ini = parseInt(getTag("ini").value);
			var fim = parseInt(getTag("fim").value);
			// CORREÇÃO DO FIM, caso o usuário selecione além do fim
			if( fim > tam - 1){
				fim = tam - 1;
				}
			getTag("tam").value = tam;
			var newTexto = "";
			newTexto = newTexto.concat(texto.substr(0,ini));
			if( pTag == "cor" ){
				newTexto = newTexto.concat("<font color="+ getTag("paleta").value +">");
				pTag = "font";
				} else {
				newTexto = newTexto.concat("<"+pTag+">");
				}
			newTexto = newTexto.concat(texto.substr(ini,fim-ini));
			newTexto = newTexto.concat("</"+pTag+">");
			newTexto = newTexto.concat(texto.substr(fim,tam-fim-1));
			getTag("area1").value = newTexto;
			// Atualiza IFrame
			docFrame(getTag("area1"));
			}
		function injectStyleSheet(){
			// Folha CSS
			 let sty = document.createElement("style");
			sty.innerText = ESTILOS;
			var headIframe = getTag("frame1").contentDocument.head;
			// Se os estilos não tiverem sido transferidos, injeta no IFRAME
			if( headIframe.innerText == "" ){
				headIframe.appendChild(sty);
				}

			}
		function frameRefresh(obj){
			setTimeout(function(){
				var txtHtm = obj.value;
				var f = getTag("frame1");
				var d = f.contentDocument;
				var b = d.body;
				b.innerHTML = txtHtm;
				f.focus();
				}, 1500);
			}
		function docFrame(obj){
			// Folha CSS
			injectStyleSheet();
			//getTag("frame1").contentDocument.head.appendChild(sty);
			// Conteudo
			frameRefresh(obj);
			}
		// CUIDADO: estilo é o formato sem traço ("-")
		// Configura o estilo de uma TAG/Seletor de TAG
		function setTagStyle(obj, estilo, valor){
			var cmd = "document.querySelector('"+obj+"').style."+estilo+" = "+valor;
			eval(cmd);
			return; 
			}
		// Exibe o menu de contexto geral na posição do clique do mouse
		function contexto(e){
			console.log("Contexto");
			var source = e.target || e.srcElement;
			console.log(source);
			mostra("tools");
			setTagStyle("DIV#tools", "top", e.clientY);
			setTagStyle("DIV#tools", "left", e.screenX);
			e.preventDefault();
			e.stopPropagation();
			}
		/*
			Função executada no ONLOAD da página
		*/
		function init(){
			fillTitle();
			ESTILOS = document.querySelector("style");
			var S = "";
			var Regra = "";
			var TAG = "";
			var colecao = ESTILOS.sheet.rules;
			var arr = null;
			var arrFmt = null;
			for( item in colecao ) {
				if( colecao[item].cssText ){
					Regra = colecao[item].cssText;
					arr = Regra.split(".");
					TAG = arr[0];
					if( arr[1] ){
						arrFmt = arr[1].split("{");
						arr = arr[1].split(" ");
						if( arr[0].substr(0,5) == "frame" ){
							Regra = TAG + " {" + arrFmt[1];
							S +=Regra + " ";
							}
						}
					}
				};
			ESTILOS = S;
			}
		function styleTag(){
			var INI = getTag("ini").value;
			var FIM = getTag("fim").value;
			var texto = getTag("area1").value;
			var Soma = ( texto.substr(INI,1) == "<" ) + ( texto.substr(FIM-1,1) == ">" );
			if( !(Soma == 2 &&  texto.substr(parseInt(INI)+1,1) != "/") ) {
				alert("Selecione corretamente uma tag, do sinal '<' até o '>' ");
				return;
				}
			}
	</script>
</head>
<body onload="init();">
	<h1 id="titulo">&nbsp;</h1>
	<div id="geral">
		<div id="main">
			<nav style="float: clear;">
				<button onclick="cerca('h1');">H1</button>
				<button onclick="cerca('h2');">H2</button>
				<button onclick="cerca('h3');">H3</button>
				<button class=big onclick="cerca('i');">I</button>
				<button class=big onclick="cerca('b');">N</button>
				<button onclick="cerca('div');">DIV</button>
				<button class=big onclick="cerca('p');">P</button>
				<button onclick="cerca('cor');">Cor</button>
				<input type=color id=paleta>
			</nav>
			<textarea id="area1" cols=45 rows=11 oncontextmenu="contexto(event);" onselect="getSele();" onchange="docFrame(this);" onpaste="frameRefresh(this);">
			
			</textarea><br>
			<div id="painel">
				<label>Seleção: </label><input id="ini" size=4>&rarr;<input id="fim" size=4>
				<label>Tamanho:</label><input id="tam" size=4>
			</div>
		</div>
		<div id="tela"><iframe id="frame1" height="374px" width="700px"></iframe></div>
	</div>
	<div id="tools">
		<table>
			<caption>FUNÇÕES DE CÉLULA</caption><br>
			<tbody>
				<tr>
					<td><label>Alinh.Texto: </label></td>
					<td>
						<select id="alin">
							<option value="N/A">[Escolha]
							<option value="left">Esquerda
							<option value="center">Centro
							<option value="right">Direita
							<option value="justify">Justificado
						</select>
					</td>
					<td>
						<label>Tam.Fonte: </label>
					</td>
					<td>
						<select id="tamft">
							<option value="N/A">[Escolha]
							<option value="12">12
							<option value="14">14
							<option value="16">16
							<option value="18">18
							<option value="20">20
						</select>
					</td>
				</tr>
				<tr>
					<td colspan=4>&nbsp;</td>
				</tr>
				<tr>
					<td colspan=4 align=center><button class=action onclick="styleTag();">Estiliza</button></td>
				</tr>
			</tbody>
		</table>
	</div>
</body>
</html>